<!DOCTYPE html>
<head>

	<!-- Basic Page Needs
    ================================================== -->
	<title>預約車位 | Peter Parker</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<!-- CSS
    ================================================== -->
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/main-color.css" id="colors">
	<script type="module" src="scripts/userinfo.js"></script>
	<script type="module" src="scripts/get_photo.js"></script>
	<script type="text/javascript" src="scripts/auth.js"></script> <!-- 新增：用於驗證會員是否已登入 -->
	<script type="text/javascript" src="scripts/create_order.js"></script> <!-- 新增：用於創建預約訂單 -->
	<script type="text/javascript" src="scripts/google_map.js"></script> <!-- 新增：用於Google地圖顯示停車場位置與狀態 -->
</head>

<body>

<!-- Wrapper -->
<div id="wrapper">

	<!-- Header Container
    ================================================== -->
	<header id="header-container" class="fixed fullwidth">

		<!-- Header -->
		<div id="header" class="not-sticky">
			<div class="container">

				<!-- Left Side Content -->
				<div class="left-side">

					<!--  -->
					<div id="logo">
						<a href="index.html"><img src="images/logo.png" alt=""></a>
						<a href="index.html" class="dashboard-logo"><img src="images/logo2.png" alt=""></a>
					</div>

					<!-- Mobile Navigation -->
					<div class="mmenu-trigger">
						<button class="hamburger hamburger--collapse" type="button">
						<span class="hamburger-box">
							<span class="hamburger-inner"></span>
						</span>
						</button>
					</div>

					<!-- Main Navigation -->
					<nav id="navigation" class="style-1">
						<ul id="responsive">

							<li><a href="index.html">首頁</a></li>

							<li><a>如何使用</a>
								<ul>
									<li><a href="how_to_reserve.html">如何預約車位</a></li>
									<li><a href="dashboard-messages.html">如何出租車位</a></li>
								</ul>
							</li>

							<li><a href="listings-half-screen-map-list.html">預約車位</a></li>

							<li><a>最新消息</a>
								<ul>
									<li><a href="dashboard.html">Dashboard</a></li>
									<li><a href="dashboard-messages.html">Messages</a></li>
									<li><a href="dashboard-bookings.html">Bookings</a></li>
									<li><a href="dashboard-wallet.html">Wallet</a></li>
									<li><a href="dashboard-my-listings.html">My Listings</a></li>
									<li><a href="dashboard-reviews.html">Reviews</a></li>
									<li><a href="dashboard-bookmarks.html">Bookmarks</a></li>
									<li><a href="dashboard-add-listing.html">Add Listing</a></li>
									<li><a href="dashboard-my-profile.html">My Profile</a></li>
									<li><a href="dashboard-invoice.html">Invoice</a></li>
								</ul>
							</li>

							<li><a href="#">聯絡我們</a></li>

							<li><a href="#">業主登入</a></li>


						</ul>
					</nav>
					<div class="clearfix"></div>
					<!-- Main Navigation / End -->

				</div>
				<!-- Left Side Content / End -->

				<!-- Right Side Content / End-->
				<div class="right-side">
					<!-- Header Widget -->
					<div class="header-widget">
						<!-- User Menu -->
						<div class="user-menu">
							<div class="user-name"><span><img id="avatar-preview" src="images/dashboard-avatar.jpg" alt=""></span><p style="display:inline "id="username2"></p></div>
							<ul>
								<li><a href="user_center.html"><i class="sl sl-icon-settings"></i>會員中心</a></li>
								<li><a href="user_profile.html"><i class="sl sl-icon-user"></i>會員個人資料</a></li>
							</ul>
						</div>
						<a href="index.html" id="logout_btn" class="button border with-icon" onclick="localStorage.removeItem('peterParkerToken'); localStorage.removeItem('userId');"></i>會員登出</a>
					</div>
				</div>
			</div>
			<!-- Header Widget / End -->
		</div>
		<!-- Right Side Content / End -->

</div>
<!-- Header / End -->

</header>
<div class="clearfix"></div>
<!-- Header Container / End -->

<!-- Dashboard -->
<div id="dashboard">



	<!-- Content
    ================================================== -->

	<div class="fs-container">

		<div class="fs-inner-container content">
			<div class="fs-content">

				<!-- Search -->
				<section class="search">

					<div class="row">
						<div class="col-md-12">

							<!-- Row With Forms -->
							<div class="row with-forms">

								<!-- Main Search Input -->
								<div class="col-fs-6">
									<div class="input-with-icon">
										<i class="sl sl-icon-magnifier"></i>
										<input id="search-input" type="text" placeholder="想停哪裡?" value=""/>
									</div>
								</div>

								<!-- Main Search Input -->
								<div class="col-fs-6">
									<div class="input-with-icon location">
										<div id="autocomplete-container">
											<input id="autocomplete-input" type="text" placeholder="尋找附近的車位">
										</div>
										<a href="#"><i class="fa fa-map-marker"></i></a>
									</div>
								</div>
							</div>


							<!-- Filters -->
							<div class="col-fs-12">

								<!-- Panel Dropdown / End -->
								<div class="panel-dropdown">
									<a href="#">類型</a>
									<div class="panel-dropdown-content checkboxes categories">

										<!-- Checkboxes -->
										<div class="row">
											<div class="col-md-6">
												<input id="check-1" type="checkbox" name="check" checked class="all">
												<label for="check-1">全部</label>

												<input id="check-2" type="checkbox" name="check" class="filter-option" value="平面停車場">
												<label for="check-2">平面停車場</label>

												<input id="check-3" type="checkbox" name="check" class="filter-option" value="立體停車場">
												<label for="check-3">立體停車場</label>

												<input id="check-4" type="checkbox" name="check" class="filter-option" value="地下停車場">
												<label for="check-4">地下停車場</label>
											</div>
										</div>

										<!-- Buttons -->
										<div class="panel-buttons">
											<button class="panel-cancel">取消</button>
											<button class="panel-apply" id="apply-filters">接受</button>
										</div>

									</div>
								</div>
								<!-- Panel Dropdown / End -->

								<!-- Panel Dropdown -->
								<div class="panel-dropdown wide">
									<a href="#">更多</a>
									<div class="panel-dropdown-content checkboxes">

										<!-- Checkboxes -->
										<div class="row">
											<div class="col-md-6">
												<input id="check-a" type="checkbox" name="check" checked class="all">
												<label for="check-a">全部</label>

												<input id="check-b" type="checkbox" name="check" class="filter-option" value="超過10">
												<label for="check-b">目前剩餘車位超過10</label>

												<input id="check-c" type="checkbox" name="check" class="filter-option" value="少於10">
												<label for="check-c">目前剩餘車位少於10</label>
											</div>
										</div>

										<!-- Buttons -->
										<div class="panel-buttons">
											<button class="panel-cancel">取消</button>
											<button class="panel-apply" id="apply-more-filters">接受</button>
										</div>

									</div>
								</div>
								<!-- Panel Dropdown / End -->

								<!-- Panel Dropdown -->
								<div class="panel-dropdown">
									<a href="#">距離</a>
									<div class="panel-dropdown-content">
										<input class="distance-radius" type="range" min="1" max="100" step="1" value="50" data-title="顯示所在位置半徑距離內的停車場">
										<div class="panel-buttons">
											<button class="panel-cancel">取消</button>
											<button class="panel-apply" id="apply-distance">接受</button>
										</div>
									</div>
								</div>
								<!-- Panel Dropdown / End -->

							</div>
							<!-- Filters / End -->


						</div>
							<!-- Row With Forms / End -->

					</div>
				</div>

			</section>
			<!-- Search / End -->

			<!-- Listings Container -->
			<section class="listings-container margin-top-30">
				<!-- Sorting / Layout Switcher -->
				<div class="row fs-switcher">

					<div class="col-md-6">
						<!-- Showing Results -->
						<p class="showing-results" id="showing-results">共找到0個結果</p>
					</div>

				</div>

				<!-- Listings -->
				<div class="row fs-listings" id="listing-results">
					<!-- Listings will be dynamically injected here -->
				</div>


			<!-- Listings -->
			<div class="row fs-listings">
				
				<!-- Listing Item -->
				<div class="col-lg-12 col-md-12">
					<div class="listing-item-container list-layout" data-marker-id="1">
						<a href="parking_booking_1.html" class="listing-item">

							<!-- Image -->
							<div class="listing-item-image">
								<img src="images/Parking_pic/螢幕擷取畫面 2024-09-30 184944.jpg" alt="">
								<span class="tag">地下停車場</span>
							</div>

							<!-- Content -->
							<div class="listing-item-content">
								<div class="listing-badge now-open">24小時共享</div>

								<div class="listing-item-inner">
									<h3>CITY PARKING 城市車旅停車場 國泰南京商業大樓站 <i class="verified-icon"></i></h3>
									<h4>50元
										<span>/小時</span>
									</h4>
									<span>(限小車)(非低底盤)</span>
									<div class="star-rating" data-rating="3.5">
										<div class="rating-counter">(12 則評論)</div>
									</div>
								</div>


								<span class="like-icon"></span>
							</div>
						</a>

					</div>
				</div>
				<!-- Listing Item / End -->

				<!-- Listing Item -->
				<div class="col-lg-12 col-md-12">
					<div class="listing-item-container list-layout" data-marker-id="2">
						<a href="listings-single-page.html" class="listing-item">

							<!-- Image -->
							<div class="listing-item-image">
								<img src="images/listing-item-02.jpg" alt="">
								<span class="tag">平面停車場</span>
							</div>

							<!-- Content -->
							<div class="listing-item-content">

								<div class="listing-item-inner">
								<h3>Sticky Band</h3>
								<span>Bishop Avenue, New York</span>
									<div class="star-rating" data-rating="5.0">
										<div class="rating-counter">(23 reviews)</div>
									</div>
								</div>

								<span class="like-icon"></span>

								<div class="listing-item-details">Friday, August 10</div>
							</div>
						</a>
					</div>
				</div>
				<!-- Listing Item / End -->

				<!-- Listing Item -->
				<div class="col-lg-12 col-md-12">
					<div class="listing-item-container list-layout" data-marker-id="3">
						<a href="listings-single-page.html" class="listing-item">

							<!-- Image -->
							<div class="listing-item-image">
								<img src="images/listing-item-03.jpg" alt="">
								<span class="tag">Hotels</span>
							</div>

							<!-- Content -->
							<div class="listing-item-content">

								<div class="listing-item-inner">
								<h3>Hotel Govendor</h3>
								<span>778 Country Street, New York</span>
									<div class="star-rating" data-rating="2.0">
										<div class="rating-counter">(17 reviews)</div>
									</div>
								</div>

								<span class="like-icon"></span>

								<div class="listing-item-details">Starting from $59 per night</div>
							</div>
						</a>
					</div>
				</div>
				<!-- Listing Item / End -->

				<!-- Listing Item -->
				<div class="col-lg-12 col-md-12">
					<div class="listing-item-container list-layout" data-marker-id="4">
						<a href="listings-single-page.html" class="listing-item">

							<!-- Image -->
							<div class="listing-item-image">
								<img src="images/listing-item-04.jpg" alt="">
								<span class="tag">Eat & Drink</span>
							</div>

							<!-- Content -->
							<div class="listing-item-content">
								<div class="listing-badge now-open">Now Open</div>

								<div class="listing-item-inner">
								<h3>Burger House <i class="verified-icon"></i></h3>
								<span>2726 Shinn Street, New York</span>
									<div class="star-rating" data-rating="5.0">
										<div class="rating-counter">(31 reviews)</div>
									</div>
								</div>

								<span class="like-icon"></span>
							</div>
						</a>
					</div>
				</div>
				<!-- Listing Item / End -->

				<!-- Listing Item -->
				<div class="col-lg-12 col-md-12">
					<div class="listing-item-container list-layout" data-marker-id="5">
						<a href="listings-single-page.html" class="listing-item">

							<!-- Image -->
							<div class="listing-item-image">
								<img src="images/listing-item-05.jpg" alt="">
								<span class="tag">Other</span>
							</div>

							<!-- Content -->
							<div class="listing-item-content">

								<div class="listing-item-inner">
								<h3>Airport</h3>
								<span>1512 Duncan Avenue, New York</span>
									<div class="star-rating" data-rating="3.5">
										<div class="rating-counter">(46 reviews)</div>
									</div>
								</div>

								<span class="like-icon"></span>
							</div>
						</a>
					</div>
				</div>
				<!-- Listing Item / End -->

				<!-- Listing Item -->
				<div class="col-lg-12 col-md-12">
					<div class="listing-item-container list-layout" data-marker-id="6">
						<a href="listings-single-page.html" class="listing-item">

							<!-- Image -->
							<div class="listing-item-image">
								<img src="images/listing-item-06.jpg" alt="">
								<span class="tag">Eat & Drink</span>
							</div>

							<!-- Content -->
							<div class="listing-item-content">
								<div class="listing-badge now-closed">Now Closed</div>

								<div class="listing-item-inner">
								<h3>Think Coffee</h3>
								<span>215 Terry Lane, New York</span>
									<div class="star-rating" data-rating="5.0">
										<div class="rating-counter">(31 reviews)</div>
									</div>
								</div>

								<span class="like-icon"></span>
							</div>
						</a>
					</div>
				</div>
				<!-- Listing Item / End -->

			</div>
			<!-- Listings Container / End -->


			<!-- Pagination Container -->
			<div class="row fs-listings">
				<div class="col-md-12">

					<!-- Pagination -->
					<div class="clearfix"></div>
					<div class="row">
						<div class="col-md-12">
							<!-- Pagination -->
							<div class="pagination-container margin-top-15 margin-bottom-40">
								<nav class="pagination">
									<ul>
										<li><a href="#" class="current-page">1</a></li>
										<li><a href="#">2</a></li>
										<li><a href="#">3</a></li>
										<li><a href="#"><i class="sl sl-icon-arrow-right"></i></a></li>
									</ul>
								</nav>
							</div>
						</div>
					</div>
					<div class="clearfix"></div>
					<!-- Pagination / End -->
					
					<!-- Copyrights -->
					<div class="copyrights">Copyright © 2024 Peter Parker | All Rights Reserved </div>

				</div>
			</div>
			<!-- Pagination Container / End -->
		</section>

		</div>
	</div>
	<div class="fs-inner-container map-fixed">

		<!-- Map -->
		<div id="map-container">
		    <div id="map" data-map-zoom="9" data-map-scroll="true">
		        <!-- map goes here -->
		    </div>
		</div>

	</div>
</div>


</div>
<!-- Wrapper / End -->


<!-- Scripts
================================================== -->
<script type="text/javascript" src="scripts/jquery-3.6.0.min.js"></script>
<script type="text/javascript" src="scripts/jquery-migrate-3.3.2.min.js"></script>
<script type="text/javascript" src="scripts/mmenu.min.js"></script>
<script type="text/javascript" src="scripts/chosen.min.js"></script>
<script type="text/javascript" src="scripts/slick.min.js"></script>
<script type="text/javascript" src="scripts/rangeslider.min.js"></script>
<script type="text/javascript" src="scripts/magnific-popup.min.js"></script>
<script type="text/javascript" src="scripts/waypoints.min.js"></script>
<script type="text/javascript" src="scripts/counterup.min.js"></script>
<script type="text/javascript" src="scripts/jquery-ui.min.js"></script>
<script type="text/javascript" src="scripts/tooltips.min.js"></script>
<script type="text/javascript" src="scripts/custom.js"></script>

<!-- Google Autocomplete -->
<script>
	function initAutocomplete() {
		var input = document.getElementById('autocomplete-input');
		var autocomplete = new google.maps.places.Autocomplete(input);

		autocomplete.addListener('place_changed', function() {
			var place = autocomplete.getPlace();
			if (!place.geometry) {
				return;
			}
			// Get the location and set the map accordingly
			var latitude = place.geometry.location.lat();
			var longitude = place.geometry.location.lng();
			// Update map center
			updateMap(latitude, longitude);
		});

		if ($('.main-search-input-item')[0]) {
			setTimeout(function(){
				$(".pac-container").prependTo("#autocomplete-container");
			}, 300);
		}
	}

	function updateMap(lat, lng) {
		if (typeof googleMap !== 'undefined') {
			googleMap.setCenter({ lat: lat, lng: lng });
			googleMap.setZoom(15);
		}
	}

	// Initialize Google Maps
	var googleMap;
	function initMap() {
		googleMap = new google.maps.Map(document.getElementById('map'), {
			center: { lat: 25.033, lng: 121.5654 }, // Default to Taipei
			zoom: 13
		});
	}

	// // Apply filter logic
	// document.getElementById('apply-filters').addEventListener('click', function() {
	// 	var selectedTypes = [];
	// 	document.querySelectorAll('.filter-option:checked').forEach(function(checkbox) {
	// 		selectedTypes.push(checkbox.value);
	// 	});
	// 	// Implement logic to filter and reorder parking listings based on selected types
	// 	filterParkingListings(selectedTypes);
	// });

	// document.getElementById('apply-distance').addEventListener('click', function() {
	// 	var distance = document.querySelector('.distance-radius').value;
	// 	// Get current center of the map
	// 	var center = googleMap.getCenter();
	// 	var lat = center.lat();
	// 	var lng = center.lng();
	// 	// Implement logic to filter parking spots within the selected distance
	// 	filterParkingByDistance(lat, lng, distance);
	// });
	//
	// function filterParkingListings(selectedTypes) {
	// 	// Example filtering function (needs backend integration for real data)
	// 	console.log('Filtering parking listings by types:', selectedTypes);
	// }
	//
	// function filterParkingByDistance(lat, lng, distance) {
	// 	// Example function to filter parking by distance (needs backend integration for real data)
	// 	console.log('Filtering parking listings within distance:', distance, 'from center:', lat, lng);
	// }

	document.getElementById('apply-filters').addEventListener('click', function () {
		// 獲取選擇的篩選條件
		var selectedTypes = [];
		document.querySelectorAll('.filter-option:checked').forEach(function (checkbox) {
			selectedTypes.push(checkbox.value);
		});

		var distance = document.querySelector('.distance-radius').value;

		// 調用後端 API，根據篩選條件獲取停車場列表
		fetchFilteredParkingListings(selectedTypes, distance);
	});

	function fetchFilteredParkingListings(types, distance) {
		// 向後端發送篩選條件並獲取停車場列表
		fetch('/api/getFilteredParkingListings', {
			method: 'POST',
			headers: {
				'Content-Type': 'application/json',
			},
			body: JSON.stringify({
				types: types,
				distance: distance
			})
		})
				.then(response => response.json())
				.then(data => {
					renderParkingList(data); // 使用後端返回的資料渲染列表
				})
				.catch(error => {
					console.error('Error fetching filtered parking listings:', error);
				});
	}

	function renderParkingList(parkingData) {
		var listingResults = document.getElementById('listing-results');
		listingResults.innerHTML = '';
		parkingData.forEach(function (parking, index) {
			var listingItem = `
            <div class="col-lg-12 col-md-12">
                <div class="listing-item-container list-layout" data-marker-id="${index + 1}">
                    <a href="parking_booking_1.html?parkingId=${parking.parkingId}" class="listing-item">
                        <!-- Image -->
                        <div class="listing-item-image">
                            <img src="${parking.parkingImg}" alt="">
                            <span class="tag">${parking.parkingType}</span>
                        </div>
                        <!-- Content -->
                        <div class="listing-item-content">
                            <div class="listing-item-inner">
                                <h3>${parking.parkingName} <i class="verified-icon"></i></h3>
                                <h4>${parking.hourlyRate}元<span>/小時</span></h4>
                                <div class="star-rating" data-rating="${parking.rating}">
                                    <div class="rating-counter">(${parking.reviewCount} 則評論)</div>
                                </div>
                            </div>
                            <span class="like-icon"></span>
                        </div>
                    </a>
                </div>
            </div>
        `;
			listingResults.insertAdjacentHTML('beforeend', listingItem);
		});
		document.getElementById('showing-results').textContent = `共找到${parkingData.length}個結果`;
	}


</script>
<script src="https://maps.googleapis.com/maps/api/js?libraries=places&callback=initAutocomplete"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places&callback=initMap" async defer></script>


<script type="text/javascript" src="scripts/infobox.min.js"></script>
<script type="text/javascript" src="scripts/markerclusterer.js"></script>
<script type="text/javascript" src="scripts/maps.js"></script>

<!-- Add new JavaScript code here -->
<script>
	$(document).ready(function () {
		// 搜尋功能 AJAX 請求
		$('#autocomplete-input').on('change', function () {
			let keyword = $(this).val();
			if (keyword) {
				$.ajax({
					url: '/order/searchParking',
					type: 'GET',
					data: { keyword: keyword },
					success: function (data) {
						renderParkingList(data);
					},
					error: function (err) {
						console.error('Error searching parking:', err);
					}
				});
			}
		});

		// 篩選功能 AJAX 請求
		$('.distance-radius').on('input', function () {
			let radius = $(this).val();
			let latitude = 25.033; // 預設經緯度，可用其他方式獲取
			let longitude = 121.5654;
			$.ajax({
				url: '/order/nearbyParking',
				type: 'GET',
				data: {
					latitude: latitude,
					longitude: longitude,
					radius: radius
				},
				success: function (data) {
					renderParkingList(data);
				},
				error: function (err) {
					console.error('Error finding nearby parking:', err);
				}
			});
		});

		// 渲染停車場列表的函數
		function renderParkingList(parkingData) {
			$('.fs-listings').empty();
			parkingData.forEach(function (parking, index) {
				$('.fs-listings').append(`
                <div class="col-lg-12 col-md-12">
                    <div class="listing-item-container list-layout"  data-marker-id="${index + 1}">
                        <a href="parking_booking_1.html" class="listing-item">
                            <div class="listing-item-image">
                                <img src="${parking.imageUrl}" alt="">
                                <span class="tag">${parking.type}</span>
                            </div>
                            <div class="listing-item-content">
                                <div class="listing-item-inner">
                                    <h3>${parking.name}</h3>
                                    <span>${parking.address}</span>
                                    <div class="star-rating" data-rating="${parking.rating}">
                                        <div class="rating-counter">(${parking.reviewCount} reviews)</div>
                                    </div>
                                </div>
                                <span class="like-icon"></span>
                            </div>
                        </a>
                    </div>
                </div>
            `);
			});
		}
	});
</script>
<!--
<script>
	window.onload = function() {
		// 檢查 localStorage 中是否有儲存 jwt_token（或其他會員登入標記）
		let token = localStorage.getItem('peterParkerToken');

		// 如果沒有找到 token，則跳轉回首頁
		if (!token) {
			window.location.href = 'index.html';
		}

		// 如有必要，可以在這裡檢查 token 的格式或過期時間
		// 如果您的應用程序在前端進行此類驗證。
	};
</script>
-->

</body>
</html>
