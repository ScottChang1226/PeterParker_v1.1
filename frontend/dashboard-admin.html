<!DOCTYPE html>

<head>

	<!-- Basic Page Needs================================================== -->
	<title>PeterParker-Admin</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<!-- CSS================================================== -->
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/main-color.css" id="colors">

	<style>
		/* 全局樣式 */
		body {
			font-family: 'Roboto', sans-serif;
			background-color: #f7f9fc;
			color: #333;
		}

		/* 搜索區域樣式 */
		.table-controls {
			display: flex;
			justify-content: space-between;
			padding-bottom: 10px;
		}

		.results-per-page {
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 5px;
			font-size: 14px;
			color: #333;
			white-space: nowrap;
		}

		.results-per-page select {
			height: 36px;
			padding: 0 12px;
			margin-bottom: 0;
			font-size: 14px;
			line-height: normal;
			border-radius: 4px;
			box-sizing: border-box;
		}

		.search-container {
			display: flex;
			align-items: center;
			gap: 10px;
			width: auto;
			max-width: auto;
			justify-content: flex-end;
		}

		.form-group input {
			height: 36px;
			padding: 0 12px;
			margin-bottom: 0;
			font-size: 14px;
			line-height: normal;
			border-radius: 4px;
			box-sizing: border-box;
			width: 300px;
		}

		.form-group input:focus {
			border-color: #333;
			outline: none;
		}

		#searchButton,
		#resetButton,
		#addAdminButton {
			height: 36px;
			padding: 0 12px;
			font-size: 14px;
			line-height: normal;
			border-radius: 4px;
			box-sizing: border-box;
			border: 1px solid transparent;
			color: #ffffff;
			transition: background-color 0.3s ease, border-color 0.3s ease;
		}

		#searchButton {
			background-color: #1976D2;
		}

		#searchButton:hover {
			background-color: #125fa7;
		}

		#resetButton {
			background-color: #f44336;
		}

		#resetButton:hover {
			background-color: #d32f2f;
		}

		#addAdminButton {
			background-color: #4CAF50;
		}

		#addAdminButton:hover {
			background-color: #45a049;
		}

		/* 表格樣式 */
		.data-table {
			width: 100%;
			border-collapse: collapse;
			background-color: #ffffff;
			border: 1px solid #e0e0e0;
		}

		.data-table th,
		.data-table td {
			padding: 12px;
			text-align: left;
			font-size: 14px;
			border: 1px solid #e0e0e0;
			/* 增加每個單元格的邊框 */
		}

		.data-table th {
			background-color: #f1f3f5;
			color: #555;
			font-weight: 600;
		}

		.data-table tr:hover {
			background-color: #f9f9f9;
		}

		/* 刪除按鈕樣式 */
		.delete-link:hover {
			color: #d32f2f;
		}

		/* 分頁按鈕區域 */
		#pagination {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding-top: 10px;
		}

		.pagination-info {
			font-size: 14px;
			color: #333;
		}

		.pagination-buttons {
			display: flex;
			gap: 5px;
		}

		.pagination-buttons button {
			padding: 5px 12px;
			border: 1px solid #ccd1d9;
			background-color: #ffffff;
			color: #333;
			cursor: pointer;
			border-radius: 4px;
			transition: background-color 0.3s ease, border-color 0.3s ease;
		}

		.pagination-buttons button:hover {
			background-color: #e0e0e0;
		}

		.pagination-buttons button.active {
			background-color: #1976D2;
			color: #ffffff;
			border-color: #1976D2;
		}

		.pagination-buttons button:disabled {
			background-color: #f0f0f0;
			color: #b3b3b3;
			border-color: #ddd;
			cursor: not-allowed;
		}

		/* 彈出視窗樣式 */
		.modal {
			display: none;
			position: fixed;
			z-index: 1000;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			background-color: rgba(0, 0, 0, 0.5);
			justify-content: center;
			align-items: center;
		}

		.modal-content {
			background-color: #fff;
			padding: 20px;
			border-radius: 8px;
			width: 400px;
			text-align: center;
		}

		.close {
			color: #aaa;
			float: right;
			font-size: 28px;
			font-weight: bold;
			cursor: pointer;
		}

		.close:hover,
		.close:focus {
			color: #000;
			text-decoration: none;
			cursor: pointer;
		}

		/* 表單樣式 */
		.modal-content input,
		.modal-content select,
		.modal-content button {
			width: 100%;
			padding: 10px;
			margin: 10px 0;
			border: 1px solid #ccc;
			border-radius: 4px;
		}

		.modal-content button {
			background-color: #4CAF50;
			color: white;
			border: none;
			cursor: pointer;
		}

		.modal-content button:hover {
			background-color: #45a049;
		}
	</style>

</head>

<body>

	<!-- Wrapper -->
	<div id="wrapper">

		<!-- Header Container
================================================== -->
		<header id="header-container" class="fixed fullwidth dashboard">

			<!-- Header -->
			<div id="header" class="not-sticky">
				<div class="container">

					<!-- Left Side Content -->
					<div class="left-side">

						<!-- Logo -->
						<div id="logo">
							<a href="dashboard-main.html"><img src="images/PeterParker_Logo2.png" alt=""></a>
							<a href="dashboard-main.html" class="dashboard-logo"><img src="images/PeterParker_Logo.png"
									alt=""></a>
						</div>

						<!-- Mobile Navigation -->
						<div class="mmenu-trigger">
							<button class="hamburger hamburger--collapse" type="button">
								<span class="hamburger-box">
									<span class="hamburger-inner"></span>
								</span>
							</button>
						</div>

						<!-- Main Navigation -->
						<!-- <nav id="navigation" class="style-1">
							<ul id="responsive">
								<li><a href="#">首頁</a></li>
							</ul>
						</nav>
						<div class="clearfix"></div> -->
						<!-- Main Navigation / End -->

					</div>
					<!-- Left Side Content / End -->

					<!-- Right Side Content 導覽列-右  -->
					<div class="right-side">
						<!-- Header Widget -->
						<div class="header-widget">

							<!-- User Menu -->
							<div class="user-menu">
								<div class="user-name">
									<span>
										<img id="profile-avatar" src="images/dashboard-avatar.jpg" />
									</span>
									帳號中心
								</div>
								<ul>
									<li><a href="javascript:void(0)" id="my-account-link"><i
												class="sl sl-icon-user"></i> 我的帳號</a></li>
									<li><a href="#" onclick="logout()"><i class="sl sl-icon-power"></i> 登出</a></li>
								</ul>
							</div>

						</div>
						<!-- Header Widget / End -->
					</div>
					<!-- Right Side Content / End -->

				</div>
			</div>
			<!-- Header / End -->

		</header>
		<div class="clearfix"></div>
		<!-- Header Container / End -->


		<!-- Dashboard 側邊欄-->
		<div id="dashboard">

			<!-- Navigation
	================================================== -->

			<!-- Responsive Navigation Trigger -->
			<a href="#" class="dashboard-responsive-nav-trigger"><i class="fa fa-reorder"></i> 儀表板欄位</a>

			<div class="dashboard-nav">
				<div class="dashboard-nav-inner">

					<ul data-submenu-title="主要">
						<li><a href="dashboard-main.html"><i class="sl sl-icon-settings"></i> 儀表板</a></li>
						<!-- <li><a><i class="sl sl-icon-note"></i> 資料審核</a>
							<ul>
								<li><a href="dashboard-approve1.html"> 審核一般會員資料 </a></li>
								<li><a href="dashboard-approve2.html"> 審核業主資料 </a></li>
							</ul>
						</li> -->
						<!-- <li><a><i class="im im-icon-Newspaper"></i> 最新消息</a></li> -->
					</ul>

					<ul data-submenu-title="資料查詢">
						<li><a><i class="sl sl-icon-layers"></i> 會員資料</a>
							<ul>
								<li><a href="dashboard-users.html"> 一般會員 </a></li>
								<li><a href="dashboard-owners.html"> 業主 </a></li>
							</ul>
						</li>
						<li><a href="dashboard-order.html"><i class="sl sl-icon-star"></i> 訂單查詢</a></li>
						<!-- <li><a><i class="sl sl-icon-wallet"></i> 財務進帳</a></li> -->
					</ul>

					<ul data-submenu-title="帳號">
						<li><a href="dashboard-admin.html"><i class="sl sl-icon-user"></i> 管理員總覽</a></li>
						<li><a href="dashboard-login.html"><i class="sl sl-icon-power"></i> 登出</a></li>
					</ul>

				</div>
			</div>
			<!-- Navigation / End -->

			<!-- Content
	================================================== -->
			<div class="dashboard-content">
				<!-- Titlebar -->
				<div id="titlebar">
					<div class="row">
						<div class="col-md-12">
							<h2>管理員總覽</h2>
							<!-- Breadcrumbs -->
							<nav id="breadcrumbs">
								<ul>
									<li><a href="#">儀表板</a></li>
									<li><a href="#">管理員總覽</a></li>
								</ul>
							</nav>
						</div>
					</div>
				</div>

				<!-- 查詢功能 -->
				<div class="content-wrapper">

					<div class="table-controls">
						<div class="results-per-page">
							<span for="resultsPerPage">顯示</span>
							<select id="resultsPerPage">
								<option value="5">5</option>
								<option value="10" selected>10</option>
								<option value="20">20</option>
							</select>
							<span>筆結果</span>
						</div>
						<div class="search-container">
							<div class="form-group">
								<input type="text" id="generalSearch" placeholder="輸入名字或狀態">
							</div>
							<button id="searchButton">查詢</button>
							<button id="resetButton" class="reset-button">取消查詢</button>
							<button id="addAdminButton">新增管理員</button>
						</div>
					</div>

					<!-- 彈出視窗 -->
					<div id="addAdminModal" class="modal">
						<div class="modal-content">
							<span class="close">&times;</span>
							<h2>新增管理員</h2>
							<form id="addAdminForm">
								<input type="text" id="adminName" name="adminName" placeholder="管理員名稱" required>
								<input type="text" id="adminUsername" name="adminUsername" placeholder="帳號" required>
								<input type="password" id="adminPassword" name="adminPassword" placeholder="密碼"
									required>
								<select id="adminStatus" name="adminStatus" required>
									<option value="">選擇狀態</option>
									<option value="啟用中">啟用中</option>
									<option value="未啟用">未啟用</option>
								</select>
								<button type="submit">新增</button>
							</form>
						</div>
					</div>

					<!-- 你的表格 -->
					<table id="user-table">
						<!-- 表格標頭與內容 -->
					</table>

					<!-- 資料表格 -->
					<table class="data-table">
						<thead>
							<tr>
								<th id="sort-id">管理員ID</th>
								<th>名字</th>
								<th>帳號</th>
								<th>密碼</th>
								<th>照片</th>
								<th>狀態</th>
								<th>操作</th>
							</tr>
						</thead>
						<tbody>

						</tbody>
					</table>

					<!-- 分頁按鈕區域 -->
					<div id="pagination">
						<div class="results-info"></div>
						<div class="pagination-info"></div>
						<div class="pagination-buttons"></div>
					</div>

					<!-- Copyrights -->
					<div class="col-md-12">
						<div class="copyrights">© 2024 PeterParker. All Rights Reserved.</div>
					</div>

				</div>

				<!-- Content / End -->


			</div>
			<!-- Dashboard / End -->


		</div>
		<!-- Wrapper / End -->


		<!-- Scripts
================================================== -->
		<script type="text/javascript" src="scripts/jquery-3.6.0.min.js"></script>
		<script type="text/javascript" src="scripts/jquery-migrate-3.3.2.min.js"></script>
		<script type="text/javascript" src="scripts/mmenu.min.js"></script>
		<script type="text/javascript" src="scripts/chosen.min.js"></script>
		<script type="text/javascript" src="scripts/slick.min.js"></script>
		<script type="text/javascript" src="scripts/rangeslider.min.js"></script>
		<script type="text/javascript" src="scripts/magnific-popup.min.js"></script>
		<script type="text/javascript" src="scripts/waypoints.min.js"></script>
		<script type="text/javascript" src="scripts/counterup.min.js"></script>
		<script type="text/javascript" src="scripts/jquery-ui.min.js"></script>
		<script type="text/javascript" src="scripts/tooltips.min.js"></script>
		<script type="text/javascript" src="scripts/custom.js"></script>
		<script type="text/javascript" src="scripts/loadProfileAvatar.js"></script>
		<script src="scripts/setMyAccountLink.js"></script>
		<script src="scripts/addadmin.js"></script>
		<script src="scripts/search.js"></script>

		<script>
			document.addEventListener('DOMContentLoaded', function () {
				const table = document.querySelector('.data-table tbody');  // 選擇表格主體
				let rows = [];  // 儲存顯示的資料行
				let allRows = [];  // 儲存所有資料的副本，用於查詢功能
				let rowsPerPage = 10;  // 每頁顯示的資料數量
				let currentPage = 1;  // 當前頁數

				const resultsInfoDiv = document.querySelector('.results-info');  // 顯示結果資訊的區域
				const resultsPerPageSelect = document.getElementById('resultsPerPage');  // 每頁顯示筆數的下拉選單

				// 更新顯示的範圍和總筆數
				const updateResultsInfo = () => {
					const startResult = (currentPage - 1) * rowsPerPage + 1;
					const endResult = Math.min(currentPage * rowsPerPage, allRows.length);
					resultsInfoDiv.innerHTML = `顯示第 ${startResult} 至 ${endResult} 筆結果，共 <span style="color:red; font-weight:bold;">${allRows.length}</span> 筆`;
				};

				// 使用 fetch 請求後端 API 獲取會員資料
				const fetchUsers = () => {
					fetch('http://localhost:8080/api/admin/all', {
						method: 'GET',
						headers: {
							'Content-Type': 'application/json'
						}
					})
						.then(response => {
							if (!response.ok) {
								throw new Error('Network response was not ok ' + response.statusText);
							}
							return response.json();
						})
						.then(data => {
							rows = data.map(user => createRow(user));  // 將每個用戶資料轉換為表格行
							allRows = [...rows];  // 將所有資料的副本保存到 allRows
							displayRows(currentPage);  // 顯示當前頁的資料
							setupPagination();  // 設定分頁邏輯
							updateResultsInfo();  // 更新顯示筆數範圍
							setAllRows(allRows);  // 初始化查詢功能
						})
						.catch(error => {
							console.error('無法獲取管理員資料:', error);
						});
				};

				// 將每個用戶轉換為一行表格
				const createRow = (admin) => {
					const row = document.createElement('tr');
					const maskedPassword = '*'.repeat(admin.adminPassword.length);
					const profileImgSrc = `http://localhost:8080/api/admin/image/${admin.adminId}`;

					row.innerHTML = `
						<td>${admin.adminId}</td>
						<td>${admin.adminName}</td>
						<td>${admin.adminUsername}</td>
						<td>${maskedPassword}</td>
						<td><img src="${profileImgSrc}" alt="Profile Image" width="50" height="50" onerror="this.src='images/user-avatar.jpg'" /></td>
						<td>${admin.adminStatus}</td>
						<td>
							<a href="dashboard-admin-inner.html?adminId=${admin.adminId}" class="edit-link">修改</a> |
							<a href="#" class="delete-link" data-id="${admin.adminId}">刪除</a>
						</td>
					`;
					return row;
				};

				// 顯示當前頁的資料行
				const displayRows = (page) => {
					table.innerHTML = '';  // 清空表格顯示
					rows.slice((page - 1) * rowsPerPage, page * rowsPerPage).forEach(row => table.appendChild(row));
					updateResultsInfo();  // 每次顯示新頁面時更新顯示筆數範圍
					bindDeleteButtons();  // 綁定刪除按鈕的事件
				};

				// 綁定刪除按鈕的事件
				const bindDeleteButtons = () => {
					document.querySelectorAll('.delete-link').forEach(button => {
						button.onclick = (e) => {
							e.preventDefault();
							const adminId = e.target.getAttribute('data-id');
							if (confirm('你確定要刪除這筆資料嗎？')) {
								deleteAdmin(adminId);
							}
						};
					});
				};

				// 刪除管理員
				const deleteAdmin = (adminId) => {
					fetch(`http://localhost:8080/api/admin/${adminId}`, {
						method: 'DELETE'
					})
						.then(response => {
							if (!response.ok) {
								throw new Error('刪除失敗: ' + response.statusText);
							}
							// 更新 rows 和 allRows 中的資料，刪除成功後重新渲染表格
							rows = rows.filter(row => row.querySelector('.delete-link').getAttribute('data-id') !== adminId);
							allRows = allRows.filter(row => row.querySelector('.delete-link').getAttribute('data-id') !== adminId);
							displayRows(currentPage);  // 刷新頁面顯示
							setupPagination();  // 更新分頁按鈕
						})
						.catch(error => {
							console.error('刪除失敗:', error);
						});
				};

				// 每頁顯示筆數的變更事件
				resultsPerPageSelect.addEventListener('change', (event) => {
					rowsPerPage = parseInt(event.target.value);
					displayRows(currentPage = 1);  // 回到第一頁並重新顯示
					setupPagination();  // 更新分頁
					updateResultsInfo();  // 更新顯示筆數範圍
				});

				// 初始化分頁邏輯
				const setupPagination = () => {
					const totalPages = Math.ceil(allRows.length / rowsPerPage);
					const paginationInfoDiv = document.querySelector('.pagination-info');
					const paginationButtonsDiv = document.querySelector('.pagination-buttons');

					paginationInfoDiv.innerHTML = '';
					paginationButtonsDiv.innerHTML = '';

					const prevButton = createButton('上一頁', currentPage === 1, () => {
						currentPage--;
						displayRows(currentPage);
						setupPagination();
					});
					paginationButtonsDiv.appendChild(prevButton);

					for (let i = 1; i <= totalPages; i++) {
						const pageButton = createButton(i, i === currentPage, () => {
							currentPage = i;
							displayRows(currentPage);
							setupPagination();
						});
						pageButton.classList.toggle("active", i === currentPage);
						paginationButtonsDiv.appendChild(pageButton);
					}

					const nextButton = createButton('下一頁', currentPage === totalPages, () => {
						currentPage++;
						displayRows(currentPage);
						setupPagination();
					});
					paginationButtonsDiv.appendChild(nextButton);
				};

				const createButton = (text, disabled, onClick) => {
					const btn = document.createElement('button');
					btn.innerText = text;
					btn.disabled = disabled;
					btn.onclick = onClick;
					return btn;
				};

				fetchUsers();  // 初始化顯示
			});
		</script>


</body>

</html>