<!DOCTYPE html>

<head>

	<!-- Basic Page Needs
================================================== -->
	<title>Listeo</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<!-- CSS
================================================== -->
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/main-color.css" id="colors">
	
</head>

<body>

	<!-- Wrapper -->
	<div id="wrapper">

		<!-- Header Container
================================================== -->
		<header id="header-container" class="fixed fullwidth dashboard">

			<!-- Header -->
			<div id="header" class="not-sticky">
				<div class="container">

					<!-- Left Side Content -->
					<div class="left-side">

						<!-- Logo -->
						<div id="logo">
							<a href="index.html"><img src="images/logo.png" alt=""></a>
							<a href="index.html" class="dashboard-logo"><img src="images/logo2.png" alt=""></a>
						</div>

						<!-- Mobile Navigation -->
						<div class="mmenu-trigger">
							<button class="hamburger hamburger--collapse" type="button">
								<span class="hamburger-box">
									<span class="hamburger-inner"></span>
								</span>
							</button>
						</div>

				<!-- Main Navigation -->
				<nav id="navigation" class="style-1">
					<ul id="responsive">

						<li><a href="index.html">首頁</a>
						</li>

						<li><a>如何使用</a>
							<ul>
								<li><a href="how_to_reserve.html">如何預約車位</a></li>
								<li><a href="dashboard-messages.html">如何出租車位</a></li>
							</ul>
						</li>

						<li><a>最新消息</a>
						</li>

						<li><a href="#">聯絡我們</a></li>


							
						
					</ul>
				</nav>
				<div class="clearfix"></div>
				<!-- Main Navigation / End -->
					</div>
					<!-- Left Side Content / End -->

					<!-- Right Side Content / End -->
					<div class="right-side">
						<!-- Header Widget -->
						<div class="header-widget">

							<!-- User Menu -->
							<div class="user-menu">
								<div class="user-name"><span><img src="images/dashboard-avatar.jpg" alt=""></span>Hi,
									Tom!</div>
								<ul>
									<li><a href="dashboard.html"><i class="sl sl-icon-settings"></i> Dashboard</a></li>
									<li><a href="dashboard-messages.html"><i class="sl sl-icon-envelope-open"></i>
											Messages</a></li>
									<li><a href="dashboard-bookings.html"><i class="fa fa-calendar-check-o"></i>
											Bookings</a></li>
											<li><a href="#" id="logoutLink"><i class="sl sl-icon-power"></i> 登出</a></li>
								</ul>
							</div>

							<a href="dashboard-add-listing.html" class="button border with-icon">新增停車場 <i
									class="sl sl-icon-plus"></i></a>
						</div>
						<!-- Header Widget / End -->
					</div>
					<!-- Right Side Content / End -->

				</div>
			</div>
			<!-- Header / End -->

		</header>
		<div class="clearfix"></div>
		<!-- Header Container / End -->


		<!-- Dashboard -->
		<div id="dashboard">

			<!-- Navigation
	================================================== -->

			<!-- Responsive Navigation Trigger -->
			<a href="#" class="dashboard-responsive-nav-trigger"><i class="fa fa-reorder"></i> Dashboard Navigation</a>

			<div class="dashboard-nav">
				<div class="dashboard-nav-inner">

					<ul data-submenu-title="Main">
						<li><a href="dashboard.html"><i class="sl sl-icon-settings"></i> 首頁</a></li>
						<li class="active"><a href="dashboard-messages.html"><i class="sl sl-icon-envelope-open"></i>
								最新消息 <span class="nav-tag messages">2</span></a></li>
						<li><a href="dashboard-bookings.html"><i class="fa fa-calendar-check-o"></i> 訂單管理</a></li>
						<li><a href="dashboard-wallet.html"><i class="sl sl-icon-wallet"></i> 本月收益</a></li>
					</ul>

					<ul data-submenu-title="Listings">
						<li><a><i class="sl sl-icon-layers"></i> 我的停車場</a>
							<ul>
								<li><a href="dashboard-my-listings.html">Active <span class="nav-tag green">6</span></a>
								</li>
								<li><a href="dashboard-my-listings.html">Pending <span
											class="nav-tag yellow">1</span></a></li>
								<li><a href="dashboard-my-listings.html">Expired <span class="nav-tag red">2</span></a>
								</li>
							</ul>
						</li>
						<li><a href="dashboard-bookmarks.html"><i class="sl sl-icon-heart"></i> 我的黑名單</a></li>
						<li><a href="dashboard-add-listing.html"><i class="sl sl-icon-plus"></i> 新增停車場</a></li>
					</ul>

					<ul data-submenu-title="Account">
						<li><a href="dashboard-my-profile.html"><i class="sl sl-icon-user"></i> 個人檔案</a></li>
						<li><a href="#" id="logoutButton"><i class="sl sl-icon-power"></i> 登出</a></li>
					</ul>

				</div>
			</div>
			<!-- Navigation / End -->


			<!-- Content
	================================================== -->
			<div class="dashboard-content">

				<!-- Titlebar -->
				<div id="titlebar">
					<div class="row">
						<div class="col-md-12">
							<h2>新增停車場</h2>
							<!-- Breadcrumbs -->
							<nav id="breadcrumbs">
								<ul>
									<li><a href="#">Home</a></li>
									<li><a href="#">Dashboard</a></li>
									<li>新增停車場</li>
								</ul>
							</nav>
						</div>
					</div>
				</div>

				<div class="row">
					<div class="col-lg-12">

						<div id="add-listing">

							<!-- Section -->
							<div class="add-listing-section">

								<!-- Headline -->
								<div class="add-listing-headline">
									<h3><i class="sl sl-icon-doc"></i> Basic Informations</h3>
								</div>

								<!-- Title -->
								<div class="row with-forms">
									<div class="col-md-12">
										<h5>停車場名稱 <i class="tip" data-tip-content="您的停車場名稱"></i></h5>
										<input class="search-field" type="text" id="parkingName" value="" />
									</div>
								</div>

								<div class="row with-forms">
									<div class="col-md-12">
										<h5>車位數量 <i class="tip" data-tip-content="請輸入停車場的車位數量"></i></h5>
										<input class="search-field" type="number" min="0" value="" placeholder="車位數量" />
									</div>
								</div>




							</div>
							<!-- Section / End -->

							<!-- Section -->
							<div class="add-listing-section margin-top-45">

								<!-- Headline -->
								<div class="add-listing-headline">
									<h3><i class="sl sl-icon-location"></i> Location</h3>
								</div>

								<div class="submit-section">

									<!-- Row -->
									<div class="row with-forms">

										<!-- City -->
										<div class="col-md-6">
											<h5>地區</h5>
											<select class="chosen-select-no-single">
												<option label="blank">選擇縣市</option>
												<!-- 直轄市 -->
												<option>臺北市</option>
												<option>新北市</option>
												<option>桃園市</option>
												<option>臺中市</option>
												<option>臺南市</option>
												<option>高雄市</option>
												
												<!-- 省轄市 -->
												<option>基隆市</option>
												<option>新竹市</option>
												<option>嘉義市</option>
												
												<!-- 縣 -->
												<option>宜蘭縣</option>
												<option>新竹縣</option>
												<option>苗栗縣</option>
												<option>彰化縣</option>
												<option>南投縣</option>
												<option>雲林縣</option>
												<option>嘉義縣</option>
												<option>屏東縣</option>
												<option>臺東縣</option>
												<option>花蓮縣</option>
												<option>澎湖縣</option>
												<option>金門縣</option>
												<option>連江縣</option>
											</select>
										</div>

										<!-- Address -->
										<div class="col-md-6">
											<h5>地址</h5>
											<input type="text" placeholder="e.g. 964 School Street">
										</div>

									</div>
									<!-- Row / End -->

								</div>
							</div>
							<!-- Section / End -->




							<!-- Section -->
							<div class="add-listing-section margin-top-45">

								<!-- Headline -->
								<div class="add-listing-headline">
									<h3><i class="sl sl-icon-docs"></i> Google Map</h3>
								</div>



								<!-- Row -->
								<div class="row with-forms">
									<!-- 經度 -->
									<div class="col-md-4">
										<h5>經度 </h5>
										<input type="text" id="longitude">
									</div>

									<!-- 緯度 -->
									<div class="col-md-4">
										<h5>緯度 </h5>
										<input type="text" id="latitude">
									</div>
								</div>
								<!-- Section / End -->






								<!-- Section -->
								<div class="add-listing-section margin-top-45">

									<!-- Headline -->
									<div class="add-listing-headline">
										<h3><i class="sl sl-icon-book-open"></i> 價錢設定</h3>
										<!-- Switcher -->
										<label class="switch"><input type="checkbox" checked><span
												class="slider round"></span></label>
									</div>

									<div class="switcher-content">
										<table id="pricing-list-container">
											<!-- 第一列：平日收費 -->
											<tr class="pricing-list-item">
												<td>
													<i class="sl sl-icon-cursor-move"></i>
													<input type="text" value="平日收費" class="pricing-name" readonly />
													<input type="text" placeholder="Price" data-unit="USD"
														class="pricing-price" />
												</td>
											</tr>
											<!-- 第二列：假日收費 -->
											<tr class="pricing-list-item">
												<td>
													<i class="sl sl-icon-cursor-move"></i>
													<input type="text" value="假日收費" class="pricing-name" readonly />
													<input type="text" placeholder="Price" data-unit="USD"
														class="pricing-price" />
												</td>
											</tr>
										</table>
									</div>
								</div>
								<!-- Section / End -->


								<a href="#" class="button preview">建立停車場 <i class="fa fa-arrow-circle-right"></i></a>

							</div>
						</div>

			<!-- Copyrights -->
			<div class="col-md-12">
				<div class="copyrights">Copyright © 2024 PeterParker | All Rights Reserved</div>
			</div>

					</div>

				</div>
				<!-- Content / End -->


			</div>
			<!-- Dashboard / End -->


		</div>
		<!-- Wrapper / End -->

		<script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.2/dropzone.min.js"></script>

		<script>
			var apiUrl = "http://localhost:8081"; // 替換為你的後端 API 網址

			// Helper function to get input value by placeholder
			function getInputValue(placeholder) {
				const input = document.querySelector(`input[placeholder='${placeholder}']`);
				return input ? input.value : null;
			}
			document.querySelector(".button.preview").addEventListener("click", function (event) {
				event.preventDefault(); // 防止預設提交行為

				// 從 Session 中取得 ownerNo
				fetch(`${apiUrl}/owner/ownerNo`, {
					method: "GET",
					credentials: "include", // 攜帶 session
					headers: {
						"Content-Type": "application/json"
					}
				})
					.then(response => {
						if (response.ok) {
							return response.json();
						} else {
							throw new Error("無法取得 ownerNo！");
						}
					})
					.then(ownerNo => {
						// 收集表單資料
						const parkingName = document.getElementById("parkingName").value;
						const capacity = getInputValue("車位數量");
						const district = document.querySelector("select.chosen-select-no-single").value;
						const address = getInputValue("e.g. 964 School Street");
						const longitude = document.getElementById("longitude").value;
						const latitude = document.getElementById("latitude").value;

						// 平日收費和假日收費
						const pricingInputs = document.querySelectorAll(".pricing-price");
						const weekdayPrice = pricingInputs[0] ? pricingInputs[0].value : null;
						const weekendPrice = pricingInputs[1] ? pricingInputs[1].value : null;

						if (!longitude || !latitude || !weekdayPrice || !weekendPrice) {
							alert("請填寫完整的經度、緯度、平日收費和假日收費！");
							return;
						}

						// 構造後端需要的資料格式
						const parkingInfoData = {
							parkingName: parkingName,
							capacity: capacity ? parseInt(capacity) : null,
							parkingRegion: district,
							parkingLocation: address,
							parkingLong: parseFloat(longitude),
							parkingLat: parseFloat(latitude),
							workdayHourlyRate: parseFloat(weekdayPrice),
							holidayHourlyRate: parseFloat(weekendPrice),
						};

						// 發送 POST 請求到後端創建停車場
						return fetch(`${apiUrl}/owner/owners/${ownerNo}/parkingInfo`, {
							method: "POST",
							headers: {
								"Content-Type": "application/json"
							},
							body: JSON.stringify(parkingInfoData),
							credentials: "include"
						});
					})
					.then(response => {
						if (!response.ok) {
							throw new Error("新增停車場失敗");
						}

						// 檢查回應是否有內容
						return response.text().then(text => {
							return text ? JSON.parse(text) : {};  // 若無內容則返回空物件
						});
					})
					.then(data => {
						alert("停車場已成功新增");
						console.log("新增的停車場資訊：", data);
						window.location.href = "http://localhost:5500/dashboard-my-listings.html"; F
					})
					.catch(error => {
						console.error("錯誤：", error.message);
					});
			});

		</script>


<script>
	document.addEventListener("DOMContentLoaded", function () {
		// 定義登出功能
		function handleLogout(event) {
			event.preventDefault(); // 阻止默認的鏈接行為
	
			// 發送登出請求到後端
			fetch("http://localhost:8081/owner/logout", {
				method: "POST",
				credentials: "include" // 攜帶 Cookie
			})
			.then(response => {
				if (!response.ok) {
					return response.text().then(text => {
						throw new Error("登出失敗：" + text);
					});
				}
				return response.text();
			})
			.then(message => {
				console.log("登出成功訊息:", message);
				alert("已成功登出！");
				// 成功執行登出後跳轉到登入頁面
				window.location.href = "index.html";
			})
			.catch(error => {
				console.error("Error:", error.message);
				alert("登出失敗：" + error.message);
				// 此處不跳轉，因為登出失敗
			});
		}
	
		// 綁定登出按鈕和登出鏈接
		const logoutButton = document.getElementById("logoutButton");
		const logoutLink = document.getElementById("logoutLink");
	
		if (logoutButton) {
			logoutButton.addEventListener("click", handleLogout);
		}
		if (logoutLink) {
			logoutLink.addEventListener("click", handleLogout);
		}
	});
	</script>



		<!-- Scripts
================================================== -->
		<script type="text/javascript" src="scripts/jquery-3.6.0.min.js"></script>
		<script type="text/javascript" src="scripts/jquery-migrate-3.3.2.min.js"></script>
		<script type="text/javascript" src="scripts/mmenu.min.js"></script>
		<script type="text/javascript" src="scripts/chosen.min.js"></script>
		<script type="text/javascript" src="scripts/slick.min.js"></script>
		<script type="text/javascript" src="scripts/rangeslider.min.js"></script>
		<script type="text/javascript" src="scripts/magnific-popup.min.js"></script>
		<script type="text/javascript" src="scripts/waypoints.min.js"></script>
		<script type="text/javascript" src="scripts/counterup.min.js"></script>
		<script type="text/javascript" src="scripts/jquery-ui.min.js"></script>
		<script type="text/javascript" src="scripts/tooltips.min.js"></script>
		<script type="text/javascript" src="scripts/custom.js"></script>


		<!-- Opening hours added via JS (this is only for demo purpose) -->
		<script>
			$(".opening-day.js-demo-hours .chosen-select").each(function () {
				$(this).append('' +
					'<option></option>' +
					'<option>Closed</option>' +
					'<option>1 AM</option>' +
					'<option>2 AM</option>' +
					'<option>3 AM</option>' +
					'<option>4 AM</option>' +
					'<option>5 AM</option>' +
					'<option>6 AM</option>' +
					'<option>7 AM</option>' +
					'<option>8 AM</option>' +
					'<option>9 AM</option>' +
					'<option>10 AM</option>' +
					'<option>11 AM</option>' +
					'<option>12 AM</option>' +
					'<option>1 PM</option>' +
					'<option>2 PM</option>' +
					'<option>3 PM</option>' +
					'<option>4 PM</option>' +
					'<option>5 PM</option>' +
					'<option>6 PM</option>' +
					'<option>7 PM</option>' +
					'<option>8 PM</option>' +
					'<option>9 PM</option>' +
					'<option>10 PM</option>' +
					'<option>11 PM</option>' +
					'<option>12 PM</option>');
			});
		</script>

		<!-- DropZone | Documentation: http://dropzonejs.com -->
		<script type="text/javascript" src="scripts/dropzone.js"></script>

</body>

</html>